#!/usr/bin/env bash

# Use this script to run the new linux kernel in qemu. You need to have build
# an ext4 root filesystem image using buildroot first.

LINUX_SRC=$(repo_root)/src/linux-$(kernel_version)
BUILDROOT_SRC=$(repo_root)/src/buildroot-$(buildroot_version)

qemu-system-x86_64 \
    -kernel $(repo_root)/linux_overlay/boot/vmlinuz-$(kernel_version)\
    -boot c -m 2049M \
    -drive file=$BUILDROOT_SRC/output/images/rootfs.ext4,format=raw \
    -append "root=/dev/sda rw console=ttyS0,115200 acpi=off nokaslr" \
    -serial stdio -display none
